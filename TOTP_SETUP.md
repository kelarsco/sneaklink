# Google Authenticator (TOTP) Setup for Admin Dashboard

## ‚úÖ What Changed

The admin login has been updated to use **Google Authenticator (TOTP)** instead of Google OAuth. Now you'll use a 6-digit code from your Google Authenticator app to sign in.

---

## üöÄ Setup Instructions

### Step 1: Generate TOTP Secret

Run this command to generate a TOTP secret and QR code:

```bash
cd server
npm run generate-totp
```

This will:
- Generate a TOTP secret
- Create a QR code image (`server/totp-qr-code.png`)
- Display the secret in the console

### Step 2: Add Secret to .env

Copy the generated secret and add it to `server/.env`:

```env
ADMIN_TOTP_SECRET=JBSWY3DPEHPK3PXP
```

**Important:** Replace `JBSWY3DPEHPK3PXP` with the actual secret generated by the script.

### Step 3: Scan QR Code with Google Authenticator

1. Open **Google Authenticator** app on your phone
2. Tap the **"+"** button to add an account
3. Choose **"Scan a QR code"**
4. Scan the QR code from `server/totp-qr-code.png`
5. You should see "SneakLink Admin" in your app

### Step 4: Restart Server

After adding the secret to `.env`:

```bash
cd server
npm run dev
```

### Step 5: Login to Admin Dashboard

1. Go to: `http://localhost:8080/admin/login`
2. Open Google Authenticator on your phone
3. Find "SneakLink Admin" in the app
4. Enter the 6-digit code in the login field
5. Click "Sign In"

---

## üì± Using Google Authenticator

### Getting Your Code

1. Open the **Google Authenticator** app
2. Find **"SneakLink Admin"** in your list
3. You'll see a 6-digit code that changes every 30 seconds
4. Enter this code in the admin login page

### Code Expiration

- Codes are valid for **30 seconds**
- If your code expires, wait for the next one
- You can use codes from the previous or next 30-second window (window of 2)

---

## üîß Manual Setup (If QR Code Doesn't Work)

If you can't scan the QR code:

1. Run `npm run generate-totp` to get the secret
2. In Google Authenticator, choose **"Enter a setup key"**
3. Enter:
   - **Account name:** `SneakLink Admin`
   - **Your key:** (the base32 secret from the script)
   - **Type:** Time-based

---

## üêõ Troubleshooting

### "Invalid code" Error

**Possible causes:**
1. **Time sync issue** - Make sure your phone's time is correct
2. **Wrong code** - Make sure you're entering the current code (it changes every 30 seconds)
3. **Secret mismatch** - Verify `ADMIN_TOTP_SECRET` in `server/.env` matches the one you scanned

**Solutions:**
- Wait for a new code (30 seconds)
- Check your phone's time settings
- Verify the secret in `.env` is correct

### "TOTP secret not configured" Error

**Cause:** `ADMIN_TOTP_SECRET` is not set in `server/.env`

**Fix:**
1. Run `npm run generate-totp`
2. Add the secret to `server/.env`
3. Restart the server

### QR Code Not Generated

**Fix:**
- Make sure `qrcode` package is installed: `npm install qrcode`
- Check file permissions in `server/` directory

---

## üîê Security Notes

1. **Keep Secret Safe**
   - Never commit `ADMIN_TOTP_SECRET` to git
   - Store it securely
   - If compromised, generate a new one

2. **Backup Codes**
   - Consider saving backup codes
   - Store them in a secure password manager

3. **Multiple Admins**
   - Each admin needs to scan the same QR code
   - All admins use the same secret
   - For separate secrets per admin, you'd need a database setup

---

## üìù Quick Reference

**Generate Secret:**
```bash
cd server
npm run generate-totp
```

**Add to .env:**
```env
ADMIN_TOTP_SECRET=your_generated_secret_here
```

**Login:**
1. Go to `/admin/login`
2. Enter 6-digit code from Google Authenticator
3. Click "Sign In"

---

## ‚úÖ Verification

After setup, test the login:

1. ‚úÖ QR code generated
2. ‚úÖ Secret added to `.env`
3. ‚úÖ QR code scanned in Google Authenticator
4. ‚úÖ Server restarted
5. ‚úÖ Can see 6-digit code in Google Authenticator
6. ‚úÖ Can login with code at `/admin/login`

---

**Last Updated:** 2024
**Status:** ‚úÖ TOTP authentication ready to use!
